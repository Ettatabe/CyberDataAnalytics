\section*{Balancing data}

As mentioned earlier, a large part of the problem with classifying credit card fraud is the dataset sizes being skewed. In our case, the non-fraudulent cases dominate over the fraudulent ones in a 236691 to 345 ratio. To alleviate this, several methods exist that either grow the size of the minority class or shrink the majority class. We performed 3 such operations on their own and combined, and compared their effects on the classification with a random forest classifier. The methods we used are SMOTE, oversampling and undersampling. With SMOTE we generated new data points for the minority class. Oversampling was performed on the minority class to give the majority class additional weight in the learning phase. Finally, we performed undersampling on the majority class to use a similar number of data points as the minority class during learning. The results can be found in table \ref{table-rf-balance}.

\begin{table}[h]
\begin{adjustwidth}{-2.5cm}{}
\centering
\caption{Random forest classification results of balancing}
\label{table-rf-balance}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline
\multicolumn{2}{|l|}{Random Forest}                                                                                                                         & \multicolumn{2}{c|}{\cellcolor[HTML]{9B9B9B}{\color[HTML]{000000} No special sampling}}                                                                  & \multicolumn{2}{c|}{\cellcolor[HTML]{9B9B9B}{\color[HTML]{000000} Oversampling Chargeback}}                                                              & \multicolumn{2}{c|}{\cellcolor[HTML]{9B9B9B}{\color[HTML]{000000} Undersampling Settled}}                                                                \\ \hline
\rowcolor[HTML]{C0C0C0} 
\multicolumn{1}{|c|}{\cellcolor[HTML]{343434}{\color[HTML]{FFFFFF} Label}} & \multicolumn{1}{c|}{\cellcolor[HTML]{343434}{\color[HTML]{FFFFFF} Prediction}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} No SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} No SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} No SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} SMOTE}} \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                  & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                      & 0                                                                            & 72                                                                        & 1                                                                            & 72                                                                        & 74                                                                           & 78                                                                        \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                  & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                         & 86                                                                           & 14                                                                        & 85                                                                           & 14                                                                        & 12                                                                           & 8                                                                         \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                     & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                      & 0                                                                            & 5429                                                                      & 0                                                                            & 5483                                                                      & 5149                                                                         & 7841                                                                      \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                     & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                         & 59173                                                                        & 53744                                                                     & 59173                                                                        & 53690                                                                     & 54024                                                                        & 51332                                                                     \\ \hline
\end{tabular}
\end{adjustwidth}
\end{table}

From these results we can see that balancing methods severely affect the classification performances of classifiers with unbalanced datasets. While performing no balancing causes misclassification of almost all fraudulent records, with the above methods over 80\% of accuracy is obtained. This does increase the number of false negatives, however, and should therefore be used carefully. If false negatives are as dangerous as true negatives, these methods should not be used. We also see that oversampling performes the worst of these methods, while undersampling seems to be the clear winner. However, the bad performance of oversampling is most probably caused by not oversampling the data enough times such that the datasets are still skewed. To find out whether these results are generic enough to use on other classifiers, we performed them also with decision tree and nearest neighbour classifiers and averaged the results. These can be found in table \ref{table-avg-balance} below. Also the ROC analyses can be found in figure \ref{img-ROC-SMOTE}. From these results we can conclude that undersampling outperforms the other methods.

\begin{table}[h]
\begin{adjustwidth}{-2.5cm}{}
\centering
\caption{Average classification results of balancing}
\label{table-avg-balance}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline
\multicolumn{2}{|l|}{}                                                                                                                         & \multicolumn{2}{c|}{\cellcolor[HTML]{9B9B9B}{\color[HTML]{000000} No special sampling}}                                                                  & \multicolumn{2}{c|}{\cellcolor[HTML]{9B9B9B}{\color[HTML]{000000} Oversampling Chargeback}}                                                              & \multicolumn{2}{c|}{\cellcolor[HTML]{9B9B9B}{\color[HTML]{000000} Undersampling Settled}}                                                                \\ \hline
\rowcolor[HTML]{C0C0C0} 
\multicolumn{1}{|c|}{\cellcolor[HTML]{343434}{\color[HTML]{FFFFFF} Label}} & \multicolumn{1}{c|}{\cellcolor[HTML]{343434}{\color[HTML]{FFFFFF} Prediction}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} No SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} No SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} No SMOTE}} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} SMOTE}} \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                  & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                      & 1.67                                                                            & 46.67                                                                        & 4.33                                                                            & 44.33                                                                        & 72.00                                                                           & 75.67                                                                        \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                  & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                         & 84.33                                                                           & 39.67                                                                        & 81.67                                                                           & 41.67                                                                        & 14.00                                                                           & 10.33                                                                         \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                     & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Chargeback}                      & 4.00                                                                            & 3232.67                                                                      & 50.33                                                                            & 3048.33                                                                      & 5821.33                                                                         & 7815.67                                                                      \\ \hline
\cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                     & \cellcolor[HTML]{C0C0C0}{\color[HTML]{000000} Settled}                         & 59169.00                                                                        & 55940.33                                                                     & 59122.67                                                                        & 56124.67                                                                     & 53018.33                                                                        & 51357.33                                                                     \\ \hline
\end{tabular}
\end{adjustwidth}
\end{table}